<?php 
$filename ="Victimizacion.xls";
header("Content-type: application/vnd.ms-excel; charset=utf-8");
header('Content-type: application/ms-excel');
header('Content-Disposition: attachment; filename='.$filename);
//set_time_limit(0);
//ini_set('memory_limit','128M');
$txtPrefijoRuta = "../../";
include( $txtPrefijoRuta . "recursos/archivos/lecturaConfiguracion.php" );
include( $txtPrefijoRuta . $arrConfiguracion['librerias']['funciones'] . "funciones.php" );
include( $txtPrefijoRuta . $arrConfiguracion['carpetas']['recursos'] . "archivos/coneccionBaseDatos.php" );

// CONSULTA FINAL (OK)
/*$qryHogar = "SELECT seqFormulario, T_FRM_FORMULARIO.seqEstadoProceso, seqEtapa, bolDesplazado
			FROM T_FRM_FORMULARIO INNER JOIN T_FRM_ESTADO_PROCESO ON (T_FRM_FORMULARIO.seqEstadoProceso = T_FRM_ESTADO_PROCESO.seqEstadoProceso)
			WHERE seqEtapa IN (1,2)
";*/

$qryHogar = "SELECT seqFormulario, T_FRM_FORMULARIO.seqEstadoProceso, seqEtapa, bolDesplazado
			FROM T_FRM_FORMULARIO INNER JOIN T_FRM_ESTADO_PROCESO ON (T_FRM_FORMULARIO.seqEstadoProceso = T_FRM_ESTADO_PROCESO.seqEstadoProceso)
			WHERE seqFormulario IN (183449, 181512, 177913, 177216, 188837, 180176, 177916, 177048, 178404, 177044, 179997, 179735, 179033, 6237, 181449, 179297, 6076, 184240, 166936, 180731, 177836, 177982, 181877, 178428, 177320, 180310, 177820, 177898, 48097, 182521, 5864, 162865, 165140, 179185, 180276, 178284, 178938, 165906, 178516, 179000, 177079, 195172, 5824, 6375, 177128, 177028, 180220, 178419, 177858, 177390, 181098, 178502, 178393, 6009, 180920, 5814, 166754, 190488, 178544, 180379, 177342, 193548, 194729, 178183, 178503, 180637, 177722, 178158, 176836, 5779, 179253, 177583, 178039, 182911, 178097, 184147, 182414, 182000, 178256, 178511, 181695, 180635, 167387, 185937, 182586, 181168, 180836, 178597, 6013, 178089, 19695, 193552, 178159, 179923, 166864, 179293, 6084, 180028, 182316, 5731, 5928, 178699, 181912, 178563, 178403, 192222, 177042, 175608, 184186, 178396, 164717, 192762, 6379, 166951, 160479, 181281, 4563, 6183, 6361, 178178, 177068, 177956, 5733, 177301, 175776, 179708, 5684, 180272, 167051, 177072, 179521, 177190, 6210, 166527, 187590, 167467, 6136, 176885, 166740, 5952, 192325, 6370, 180039, 179148, 169935, 180544, 173623, 6167, 180156, 184395, 178515, 154699, 177942, 177896, 6277, 192424, 179821, 179092, 178777, 194407, 179029, 6377, 6409, 180003, 169100, 177995, 178337, 180174, 166755, 165680, 178154, 6150, 5878, 178174, 178170, 5980, 177622, 165843, 192829, 166964, 177544, 4239, 5934, 6355, 180745, 180117, 192763, 179189, 179990, 5691, 181244, 5667, 177888, 5839, 186864, 180161, 5356, 166761, 194994, 182477, 165903, 172518, 5206, 177337, 5890, 6366, 171414, 181096, 180638, 180050, 180825, 178939, 195975, 178116, 181507, 6053, 5964, 165629, 165788, 5696, 6075, 6404, 178390, 190583, 166537, 177169, 5998, 6383, 177097, 6151, 5871, 6078, 181019, 6301, 7588, 179936, 168541, 178161, 5821, 166525, 191965, 167748, 178992, 178309, 179212, 166027, 6195, 193055, 177868, 184666, 176938, 177534, 180657, 6345, 167065, 4169, 6056, 178691, 166023, 6352, 6189, 178486, 178518, 181802, 180274, 151905, 165125, 6130, 191190, 178042, 177070, 178653, 191400, 168725, 5955, 178863, 185126, 166296, 166198, 177959, 180126, 195911, 185070, 5848, 6285, 181532, 194032, 177513, 194550, 6326, 165331, 195893, 5836, 178689, 177962, 196179, 4197, 165740, 5943, 179144, 194409, 166626, 178433, 177930, 6003, 167804, 177274, 165746, 194880, 178030, 193788, 6202, 6294, 194232, 177674, 178556, 165646, 4238, 4211, 5849, 165845, 179095, 180666, 186549, 194680, 168142, 180199, 166411, 167486, 179183, 178164, 179919, 177344, 151843, 177943, 181313, 182962, 180008, 181285, 6100, 5711, 178791, 181939, 195181, 5780, 194023, 5778, 178091, 171020, 178943, 180611, 177191, 120515, 178068, 112392, 178509, 180315, 177452, 196005, 169380, 4180, 5700, 6030, 171767, 183112, 177970, 195895, 178112, 180188, 6233, 166263, 165731, 178411, 179819, 196196, 178759, 178532, 165724, 177223, 179277, 180943, 168027, 177124, 195031, 170326, 178080, 180645, 189378, 177403, 5776, 5884, 167144, 167702, 5892, 5930, 178649, 179122, 191897, 166654, 165499, 6083, 195176, 165150, 167972, 179138, 194113, 177306, 177827, 168457, 194413, 77593, 184056, 181243, 178317, 179572, 5940, 6184, 168697, 178920, 164812, 179689, 177089, 178937, 6092, 176924, 166026, 192764, 184033, 6000, 79924, 195024, 48066, 178133, 196077, 180502, 6817, 164277, 176940, 189440, 165137, 165782, 176913, 178695, 178275, 6204, 6342, 180494, 194533, 192394, 177902, 166647, 177282, 165858, 165910, 177054, 177466, 27257, 180483, 176916, 6319, 179702, 5687, 167751, 169957, 171802, 182882, 166311, 181506, 167908, 177960, 165624, 172097, 177503, 192137, 166500, 170909, 142711, 194722, 174082, 178155, 178666, 179208, 176654, 178410, 182328, 166910, 177029, 178073, 178405, 180648, 182458, 183304, 6256, 177016, 177411, 178533, 178668, 192180, 178868, 178814, 179993, 181246, 13239, 195928, 178755, 178919, 192956, 167225, 180543, 154668, 152244, 178044, 178925, 195927, 178495, 101812, 176890, 177878, 178093, 179091, 164254, 180322, 176853, 177304, 195896, 177075, 180575, 6066, 179175, 178029, 177490, 178167, 180417, 192088, 177854, 178217, 178056, 195416, 177821, 194912, 177171, 183625, 152990, 180568, 180639, 177347, 178038, 179260, 184126, 181046, 177355, 178519, 178081, 179645, 167644, 166293, 182337, 195648, 178702, 180020, 196081, 165914, 193224, 36800, 168164, 174345, 167021, 179612, 166206, 164851, 29796, 178228, 178144, 177689, 178543, 178277, 168026, 177577, 177909, 178180, 184690, 167088, 178636, 165135, 177964, 180636, 73867, 169751, 195909, 167844, 174597, 178501, 181016, 182540, 183900, 184715, 180166, 165152, 180947, 172561, 177161, 179454, 178499, 195059, 177186, 193617, 190238, 193588, 165853, 177835, 166949, 179937, 178941, 191720, 177952, 180364, 177464, 192758, 59619, 178942, 172139, 193432, 63879, 179308, 164933, 183463, 170210, 177886, 167840, 178172, 180526, 178031, 178554, 179268, 184370, 186792, 181033, 194826, 165749, 167888, 179018, 180278, 195206, 195598, 170173, 195995, 196108)
";

$exeQueryHogar = mysql_query($qryHogar);

// RECORRIENDO LOS MIEMBROS POR HOGAR

print_r("<table width='50%' align='center' cellpadding=0 cellspacing=0 border=0>");
print_r ("<tr><td>Formulario</td><td>Etapa</td><td>Estado Proceso</td><td>Hogar Desplazado</td><td>Miembros del hogar</td><td>desp forzado</td><td>otros</td></tr>");

while ($rowHogar = mysql_fetch_array($exeQueryHogar)) {
//print_r ("<tr><td>$rowHogar[seqFormulario]</td></tr>");
$n = 0;
	$qryCalifica = "SELECT c.seqCiudadano,
						numDocumento,
						seqTipoVictima,
						seqParentesco
					FROM T_CIU_CIUDADANO c
						LEFT JOIN T_FRM_HOGAR h ON (c.seqCiudadano = h.seqCiudadano)
						LEFT JOIN T_FRM_FORMULARIO f ON (h.seqFormulario = f.seqFormulario)
					WHERE f.seqFormulario = $rowHogar[seqFormulario]";
	
	//echo $qryCalifica."<br>";
	$exeCalifica = mysql_query($qryCalifica);
	$victima = 0;
	$novictima = 0;
	while ($rowCalifica = mysql_fetch_array($exeCalifica)) { 
	$n = $n + 1;
		if ($rowCalifica[seqTipoVictima] != 2 ){ // Es desplazamiento Forzado -> Hogar Vicitma
			$novictima = $novictima + 1;
		} else {
			$victima = $victima + 1;
		}
	} // FIN RECORRIDO DE INTEGRANTES DEL HOGAR
	print_r ("<tr><td>$rowHogar[seqFormulario]</td><td>$rowHogar[seqEtapa]</td><td>$rowHogar[seqEstadoProceso]</td><td>$rowHogar[bolDesplazado]</td><td>$n</td><td>$victima</td><td>$novictima</td></tr>");
}
print_r ("</table>");
?>